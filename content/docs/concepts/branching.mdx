---
title: 'Branching'
subtitle: 'Create a development or staging environment for your database through branches'
---

## Overview

PlanetScale allows you to branch database schemas the way you branch your code. 

Development database branches are isolated copies of your database created with the current production schema. They can be used to develop features and test changes without impacting your production database. When you're ready, schema changes on a development branch can be safely applied to the production database using PlanetScale’s [non-blocking schema change workflow](https://docs.planetscale.com/concepts/nonblocking-schema-changes). This workflow ensures that your changes are deployed without blocking the database, locking individual tables, or slowing down production during the migration.

![PlanetScale Branching Flow Diagram](/img/docs/ps_branching_diagram_light.png)

## Development and production branches

PlanetScale provides two types of database branches:

- **Development branches** &mdash; Development branches provide isolated copies of your production database schema where you can make changes, experiment, or run CI. Note, only the schema is copied, not the data.
- **Production branches** &mdash; Production branches are highly available databases intended for production traffic. They are protected from direct schema changes by default and include automated daily backups. To make a change to a production branch, you must [create a deploy request](#deploy-a-branch).

<InfoBlock type='tip'>
  You'll see a <inlineCode>ERROR 1105 (HY000): direct DDL is disabled</inlineCode> message if you attempt to make schema changes in a production branch. Create a development branch, and make your changes there.
</InfoBlock>

## Branch promotion 

PlanetScale provides the ability to promote any development branch with a valid schema to production. Promoting a branch to production will require future schema changes to be made via a deploy request and will engage any custom backup schedules you have configured for production branches in addition to the automatic daily backups.

### Promote the main database branch

Every PlanetScale database is created with a development branch named `main`.

This allows you to apply a schema directly to this branch, import data, and experiment with your database before promoting the branch to production. 

Once you are satisfied with the changes you have made to your `main` branch, you can promote the `main` branch to production. Going forward, you can continue to make new development branches off of the production branch whenever you need to make a schema change.

A branch can be promoted from the branch overview page in the PlanetScale app or by using the [PlanetScale CLI](/reference/branch), as showing below:

```
pscale branch promote <DATABASE_NAME> <BRANCH_NAME>
```

### Promote any development branch

Any PlanetScale development branch can be promoted to production. It's possible to run multiple production branches simultaneously, however, it's important to note that PlanetScale does not provide data syncing between production branches.

You can promote any development branch from the branch overview page, or from the [PlanetScale CLI](/reference/branch) with:

```
pscale branch promote <DATABASE_NAME> <BRANCH_NAME>
```

## Create a development branch

You can create a development branch from any production branch. Create a new branch from the branches overview page `app.planetscale.com/<ORGANIZATION>/<DATABASE>/branches`, or use the command below.

```
pscale branch create <DATABASE_NAME> <BRANCH_NAME>
```

If you'd like to create a branch from an existing branch other than the default, you can do that on the command line:

```
pscale branch create <DATABASE_NAME> <NEW_BRANCH_NAME> --from <PARENT_BRANCH_NAME>
```

## How to deploy a branch

Once you're satisfied with the schema changes you have made on a branch, you can deploy your changes to production.

### 1. Create a deploy request

If you are working in a team, the deploy request creates an opportunity for your teammates to review the changes you have made before they are deployed to production.

1. Make sure your database has a **production branch**. You cannot create a deploy request without a production branch to deploy to.
2. To create the deploy request, go to the branch overview page for the branch you want to deploy.
3. Select the production branch you want to deploy to from the "**Deploy to**" dropdown.
4. (*Optional*) Add a comment describing your deploy request.
5. Click "**Create deploy request**".

![PlanetScale deploy request example](/img/docs/create-deploy-request.png)

6. (*Optional*) You can also create a deploy request from the [PlanetScale CLI](/reference/deploy-request) with the following command:
   
```bash
pscale deploy-request create <DATABASE_NAME> <BRANCH_NAME>
```

### 2. Review the deploy request 

The deploy request includes a schema diff so that you can review the schema changes introduced by the deploy request against the production branch.

1. On the deploy request page, click the "**Schema changes**" tab. 
2. Schema additions are highlighted in green and deletions are highlighted in red.
3. (*Optional*) You can also run the command below to see the [schema diff in the PlanetScale CLI](/reference/deploy-request):

```bash
pscale deploy-request diff <DATABASE> <DEPLOY_REQUEST_NUMBER> 
```

Another benefit of the deploy request review process is that **PlanetScale will determine if certain requests aren't deployable**. For example, if you try to deploy a branch with no unique key, PlanetScale will block the deploy, as the unique key is required.

### 3. Add changes to the deploy queue

Once a deploy request has been created and approved, you will need to add the changes to the deploy queue.

Schema changes are deployed to a database in the order in which they are received. PlanetScale analyzes the schema changes in a deploy request when they are added to the deploy queue to ensure that the changes do not conflict with any of the queued schema changes.

PlanetScale provides insight on the deploy queue, listing all of the schema changes in the queue with their completion status.

1. Organizations have the option to require approval before a deploy request can be added to the queue. If this is enabled, first make sure the request is approved. You can control this option in the database's "**Settings**" tab.
2. To add a deploy request to the deploy queue, click “**Add changes to the deploy queue**” on the deploy request page. 
3. (*Optional*) You can also run the following command with the [PlanetScale CLI](/reference/deploy-request):

```
pscale deploy-request deploy <DATABASE_NAME> <DEPLOY_REQUEST_NUMBER>
```

4. If successful, you'll get the message "These changes have been deployed". 
5. Your deploy request has now been merged into production. You can click on the "Deploy requests" tab of the database to see the list of previous deploys. 

![Deploy queue](/img/docs/branching-deploy-queue.png)

## Set a default branch

Each PlanetScale database with a production branch has a default branch that cannot be deleted. 

The first database branch that gets promoted to production is automatically set as the default branch for your database. 

However, this can be updated in the database Settings tab. Use the default branch dropdown menu to select the branch you would to set as default and click the Save database settings button to save your changes. 

## Delete a branch

You can delete your branch either from the branches overview page `app.planetscale.com/<organization>/<database>/branches` or run the following command in the CLI.

```
pscale branch delete <database> <branch>
```

We recommend deleting your branch once you have used it to merge a schema change, or if you are no longer using the branch for testing. You can always create a new branch from your production database. 

<InfoBlock type="note">
Only organization administrators have permission to delete production branches. 
</InfoBlock> 

## Resolve a schema conflict

Schema conflicts occur when your development branch has conflicting changes with the production branch. 

To resolve a schema conflict, create a new branch, which will have the most up-to-date schema, and apply the necessary schema changes to the new branch before repeating the deploy process. 

## Automatically copy migration data

Many frameworks and migration tools keep track of data schema changes in a migration table. When turned on, PlanetScale will automatically copy migration table metadata from your `development` branch to the `main` branch as part of our deployment process.

To turn on for your database, go to the web app:

1. Go into the Settings for your database
2. Enable "Automatically copy migration data"
3. Select one of the migration frameworks: Rails, Phoenix, Laravel, Django, .NET, Sequelize, or Other, which allows you to specify a custom table name

You can see how this works in this [Rails migration tutorial](/tutorial/automatic-rails-migrations).

## Need help?

Get help from [PlanetScale's support team](https://www.planetscale.com/support), or join our [GitHub discussion board](https://github.com/planetscale/beta/discussions) to see how others are using PlanetScale.

<NextBlock
  steps={[
    {
      text: 'Non-blocking schema changes',
      link: '/concepts/nonblocking-schema-changes'
    },
    {
      text: 'Regions',
      link: '/concepts/regions'
    }
  ]}
></NextBlock>
